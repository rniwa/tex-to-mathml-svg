<!DOCTYPE html>
<html>
<head>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    jax: ["input/TeX","input/MathML","output/SVG","output/NativeMML"],
    extensions: ["tex2jax.js", "toMathML.js"],
});
</script>
<script src="MathJax/MathJax.js"></script>
<script>
// http://docs.mathjax.org/en/latest/toMathML.html
function toMathML(jax, callback) {
    var mathML;
    try {
        mathML = jax.root.toMathML("");
    } catch(err) {
        if (!err.restart) { throw err; } // an actual error
        return MathJax.Callback.After([toMathML, jax, callback], err.restart);
    }
    MathJax.Callback(callback)(mathML);
}

MathJax.Hub.Queue(function () {
    var jax = MathJax.Hub.getAllJax();
    toMathML(jax[0], function (mathML) {
        console.log(jax[0].originalText);
        console.log(mathML.replace(/\s*[\r\n]\s*/g, ''));
        var svgElements = document.querySelectorAll('svg');
        var serializer = new XMLSerializer();
        var svgMarkup = '';
        for (var i = 0; i < svgElements.length; i++) {
            if (!svgElements[i].getAttribute('viewBox'))
                svgElements[i].style.display = 'none';
            svgMarkup += serializer.serializeToString(svgElements[i]).replace(/href=/g, 'xlink:href=');
        }
        console.log(svgMarkup);
        console.log('done');
    });
});
</script>
</head>
<body></body>
</html>
